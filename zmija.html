<!DOCTYPE html>
<html>
<body>
<canvas id="canvas" width="1000" height="800" style="border:1px solid #c3c3c3;"></canvas>
<script>
var canvas = document.getElementById('canvas');
var context = canvas.getContext('2d');

var game=true;
var frame=0;
var reset=false;

var gore= true,		//da zna u kojem se smijeru krece
    lijevo=false,
    dolje=false,
    desno=false;

var zmija= {	x: canvas.width/2,
		y: canvas.height-50,
		w: 20,
		h: 20,
		boja: "green"
};

var rep = {	duzina:0,
		x:[],
		y:[]
};

var hrana= {	x: [100*(Math.random()*9).toFixed(2)], //napravi hranu na nekom slucajnom mjestu u canvasu
		y: [100*(Math.random()*7).toFixed(2)], 	//8 zato sto je visina 800
		w: 20,
		h: 20,
		boja: "red"
};



var map = []; // tu Ä‡u puniti key kodove koje domijem kad stisnem tipku (kad stisnem postanu true, a pusti onda false)
onkeydown = onkeyup = function(e){
	e = e || event; // event zbog internet exp
	map[e.keyCode] = e.type == 'keydown';

	if (map[37] && game) {
		lijevo=true;				//promijeni kretnju
		desno=gore=dolje=false;
	}

	else if (map[38]) {
		gore=true;
		desno=lijevo=dolje=false;
	}

	else if (map[39] && game) {
		desno=true;
		dolje=gore=lijevo=false;
	}
	else if (map[40] && game) {
		dolje=true;
		desno=gore=lijevo=false;
	}
}

function animationframe() {

	var brzina=5;

	context.clearRect(0, 0, canvas.width, canvas.height);

	for (i=0; i<=rep.duzina; i++) {				//kada bi crtao samo rep.duzina onda bi crtao samo zadnji kvadratic repa
		context.beginPath();				//i smanjuje kvadratice do prvog ali...
		context.fillStyle = zmija.boja;
		context.fillRect(rep.x[rep.x.length-(rep.duzina-i)], rep.y[rep.y.length-(rep.duzina-i)], zmija.w, zmija.h);
		context.fill();
		context.stroke();

		if (i<rep.duzina-2) {				//...onda bi zmija stalno bila mrtva jer prvi uvijek dira glavu zmije zato...  
								//...se pri koliziji ignoriraju prva 2 kvadratica
			if (zmija.x < rep.x[rep.x.length-(rep.duzina-i)] + zmija.w && zmija.x + zmija.w > rep.x[rep.x.length-(rep.duzina-i)] &&
	   		    zmija.y < rep.y[rep.y.length-(rep.duzina-i)] + zmija.h && zmija.y + zmija.h > rep.y[rep.y.length-(rep.duzina-i)]  ) { 
				game=false;			//kada se zmija sudari s repom igra je gotova
			}
		}
	}

	if (gore) zmija.y=zmija.y-brzina;			//kako se zmija krece 
	else if (lijevo) zmija.x=zmija.x-brzina;
	else if (dolje) zmija.y=zmija.y+brzina;
	else if (desno) zmija.x=zmija.x+brzina;

	if (zmija.y+zmija.h>=canvas.height || zmija.y<=0 || zmija.x+zmija.w>=canvas.width || zmija.x<=0) game=false;	//umre ako dira rub canvasa
		
	context.beginPath();
	context.fillStyle = zmija.boja;
	context.fillRect(zmija.x, zmija.y, zmija.w, zmija.h);
	context.fill();
	context.stroke();

	context.beginPath();	
	context.fillStyle = hrana.boja;
	context.fillRect(hrana.x[hrana.x.length-1], hrana.y[hrana.y.length-1], hrana.w, hrana.h);
	context.fill();
	context.stroke();

	if (zmija.x < hrana.x[hrana.x.length-1] + hrana.w && zmija.x + zmija.w > hrana.x[hrana.x.length-1] &&	//zmija se sudari s hranom
	    zmija.y < hrana.y[hrana.y.length-1] + hrana.h && zmija.y + zmija.h > hrana.y[hrana.y.length-1]) {

		hrana.x.push(100*(Math.random()*9).toFixed(2) );						//na slucajnom mjestu se napravi nova hrana
		hrana.y.push(100*(Math.random()*7).toFixed(2) );
		rep.duzina++;											//a rep postane duzi

	}

	context.beginPath();
	context.font="20px Arial";
	context.fillStyle="black";
	context.fillText("Bodovi: ", 10, canvas.height-20); 
	context.fillText(rep.duzina, 90, canvas.height-20); 
	context.fill();
	context.stroke();

	if (frame%5==0) {			//pozicija zmije na svakom petom frame-u moze biti pozicija repa
		rep.x.push(zmija.x);
		rep.y.push(zmija.y);
	}

	frame++;

	if (game) window.requestAnimationFrame(animationframe);		//ako je game==false nista se ne dogada
	else {	context.beginPath();
		context.font="65px Arial";
		context.fillStyle="black";
		context.fillText("G A M E  O V E R !", canvas.height/4, canvas.height/2); 
		context.fill();
		context.stroke();
	}	
};
window.requestAnimationFrame(animationframe);
</script>
</body>
</html>
